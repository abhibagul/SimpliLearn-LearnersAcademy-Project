<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Manage Classes</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

<link href="dashboard.css" rel="stylesheet">
</head>
<body  class="bg-light">
	<%@page import="java.sql.DriverManager"%>
	<%@page import="java.sql.ResultSet"%>
	<%@page import="java.sql.Statement"%>
	<%@page import="java.sql.Connection"%>
	<%@page import="java.sql.PreparedStatement" %>
	<%
		String session_u_name = (String)session.getAttribute("usname");
		String role = (String)session.getAttribute("role");	
	
		if(role != "admin"){
			response.sendRedirect("admin.jsp");
		}
		
		String driverName = "com.mysql.jdbc.Driver";
		String connectionUrl = "jdbc:mysql://localhost:3306/";
		String dbName = "learnersacademy";
		String userId = "root";
		String password = "root12345";
		
		
		String action = (String) request.getParameter("action");
		
%>

<main>
	<jsp:include page="sidebarComp.jsp"/>

	<div class="data">
	
	<jsp:include page="headerComp.jsp"/>
  
	
	<div class="p-3 control">


	<h4>Manage Classes</h4>
	
	
  
  
  	<div class="my-3 p-3 bg-body rounded shadow-sm">
		<form id="stdSelector" action="<%=request.getContextPath()%>/manageClasses.jsp" method="post"  class="row g-3">
  <div class="col-lg-3 col-md-6 ">
    <label for="standardSelector" class="form-label">Select Standard : </label>
    <input type="hidden" name="action" value="classSelector">
	<select class="form-control" onchange="document.getElementById('stdSelector').submit()" name="selectedStd"  id="standardSelector">
	<option>Select Standard</option>
	<%
	
		try {
			Class.forName(driverName);
		} catch (ClassNotFoundException e) {
			e.printStackTrace();
		}
	
		Connection connection = null;
		Statement statement = null;
		ResultSet resultSet = null;
	
		try{
			
			connection = DriverManager.getConnection(connectionUrl+dbName, userId, password);
			statement=connection.createStatement();
			String sql ="SELECT DISTINCT std FROM class";

			resultSet = statement.executeQuery(sql);
			
			while(resultSet.next()){
				%>
				<option value="<%=resultSet.getString("std") %>" <% if(resultSet.getString("std").equals(request.getParameter("selectedStd"))){ %> selected="selected" <% } %>><%=resultSet.getString("std") %></option>
				<%
			}

			
		}catch(Exception e){
			e.printStackTrace();
		}
	
	%>
	
	</select>
  </div>
  </form>
	</div>
	
	
	<div class="my-3 p-3 bg-body rounded shadow-sm">
		<%
		
			//out.print("Content: " + action + " for std, " + request.getParameter("selectedStd"));
			if(action != null){
				
				
				if( action.equals("classSelector")){
					
					PreparedStatement ps = connection.prepareStatement("SELECT * FROM class where std=?");
					String std;	
					ps.setString(1, request.getParameter("selectedStd"));
					
					%>
					<h4>Classes for Standard <%= request.getParameter("selectedStd") %></h4>
					
					<%
					
						
					try{
											
						
						resultSet = ps.executeQuery();
						
						while(resultSet.next()){
							%>
							
							<%= resultSet.getString("id") %>
							
							<%
						}

						
					}catch(Exception e){
						e.printStackTrace();
					}
					
			
				}
				
				
			}else{
				%>
				
				<h4 class="text-center">Please select the standard from above list.</h4>
				
				<%
			}
		%>
	</div>
	
	</div>
	<!-- /main content -->
	</div>
	
	</main>

</body>
</html>